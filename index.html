<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Another Product Invented â€“ Pente Grammai</title>
  <style>
    body {
      margin: 0; padding: 0;
      background: #fff;
      font-family: sans-serif;
      display: flex; flex-direction: column; align-items: center;
    }
    h1 {
      margin: 1rem 0 0.5rem;
      text-align: center;
      line-height: 1.2;
    }
    #gameContainer {
      position: relative;
      width: 500px; height: 500px;
      margin-bottom: 10px;
      border: 2px solid #555;
      box-sizing: border-box;
    }
    canvas {
      display: block;
      width: 100%; height: 100%;
      background: #eee;
    }
    /* Overlays */
    .overlayScreen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
      z-index: 10;
    }
    #menuScreen, #instructionsScreen, #difficultyScreen, #gameOverScreen {
      /* Each hidden by default; only one shows at a time */
    }
    button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    /* Difficulty + Side container side-by-side */
    #difficultySideContainer {
      display: flex; gap: 20px;
      flex-direction: row;
      margin-top: 10px;
    }
    #difficultyContainer, #sideContainer {
      display: flex; flex-direction: column; align-items: center;
    }
    #diceArea {
      display: flex;
      width: 500px;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #diceRollBtn {
      font-size: 18px;
      margin-left: 10px;
    }
    #pastMoves {
      width: 180px;
      border: 1px solid #444;
      background: #fafafa;
      padding: 5px;
      overflow-y: auto;
      height: 120px; /* so we can see a small scroll area if many moves */
    }
    #pastMoves ul { margin: 0; padding: 0; list-style: none; }
    #pastMoves li { margin: 2px 0; }
  </style>
</head>
<body>

<h1>Another Product Invented<br>Pente Grammai</h1>

<!-- Container for the 5-line board -->
<div id="gameContainer">
  <canvas id="gameCanvas" width="500" height="500"></canvas>

  <!-- MENU SCREEN -->
  <div id="menuScreen" class="overlayScreen" style="display:flex;">
    <button id="newGameBtn">New Game</button>
    <button id="instructionsBtn">Instructions</button>
  </div>

  <!-- INSTRUCTIONS SCREEN -->
  <div id="instructionsScreen" class="overlayScreen">
    <h2>Instructions</h2>
    <p>1) You have 5 pieces, the AI has 5 pieces, all on the center line initially.</p>
    <p>2) Roll dice. Click your piece to move it. If it lands on a rosette, you get another turn.</p>
    <p>3) The goal is to move your pieces from the center line to the final line, following the Pente Grammai path.</p>
    <p>Press [M] to return to the main menu.</p>
  </div>

  <!-- DIFFICULTY & SIDE SELECTION SCREEN -->
  <div id="difficultyScreen" class="overlayScreen">
    <h2>New Game</h2>
    <div id="difficultySideContainer">
      <!-- Difficulty column -->
      <div id="difficultyContainer">
        <p><strong>Difficulty</strong></p>
        <button id="easyBtn">Easy</button>
        <button id="mediumBtn">Medium</button>
        <button id="hardBtn">Hard</button>
      </div>
      <!-- Side column -->
      <div id="sideContainer">
        <p><strong>Side</strong></p>
        <button id="leftSideBtn">Left</button>
        <button id="rightSideBtn">Right</button>
      </div>
    </div>
  </div>

  <!-- GAME OVER SCREEN -->
  <div id="gameOverScreen" class="overlayScreen">
    <h2 id="gameOverText"></h2>
    <button id="gameOverNewGameBtn">New Game</button>
    <p>Press [M] to return to the Main Menu.</p>
  </div>
</div>

<!-- Dice + Past Moves area, on the same row (above or below? We put it above) -->
<div id="diceArea">
  <div>
    Dice: <span id="diceResult">0</span>
    <button id="diceRollBtn">Roll Dice</button>
  </div>
  <div id="pastMoves">
    <ul id="movesList"></ul>
  </div>
</div>

<script>
/*****************************************************************
 * 1) Basic Board Setup
 *****************************************************************/
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const W = canvas.width;
const H = canvas.height;

// We'll define 5 horizontal lines:
const lineCount = 5; // 0..4
// We'll define we have 7 spaces per line (like your Pente approach).
const spacesPerLine = 7;

// We'll store piece data: each piece has { line, space, color, isAI? }
let pieces = []; // total 10 pieces (5 human, 5 AI)
let difficulty = null;
let humanSide = null; // 'left' or 'right'
let currentTurn = 'human'; // or 'ai'
let diceValue = 0;
let diceRolled = false;
let gameState = "menu";
let movesHistory = [];

/*****************************************************************
 * 2) Overlays
 *****************************************************************/
const menuScreen = document.getElementById("menuScreen");
const instructionsScreen = document.getElementById("instructionsScreen");
const difficultyScreen = document.getElementById("difficultyScreen");
const gameOverScreen = document.getElementById("gameOverScreen");
const gameOverText = document.getElementById("gameOverText");
const diceResultSpan = document.getElementById("diceResult");
const movesList = document.getElementById("movesList");

/*****************************************************************
 * 3) Show/hide overlay screens
 *****************************************************************/
function showOverlay(screenId) {
  [menuScreen, instructionsScreen, difficultyScreen, gameOverScreen].forEach(s => s.style.display = "none");
  if (screenId) screenId.style.display = "flex";
}

/*****************************************************************
 * 4) Start a new game
 *****************************************************************/
function startGame() {
  // Clear old pieces
  pieces = [];
  movesHistory = [];
  movesList.innerHTML = "";
  diceValue = 0;
  diceResultSpan.textContent = "0";
  diceRolled = false;
  currentTurn = 'human'; // Start with the human

  // Place 5 human pieces, 5 AI pieces on center line (line = 2).
  // If side is left, we'll place them at spaces 0..4. If side is right, we'll place them at spaces 2..6. 
  // (Adjust as you see fit.)
  if (humanSide === 'left') {
    // Human pieces on line=2, spaces= 0..4
    for (let i = 0; i < 5; i++) {
      pieces.push({ line: 2, space: i, color: 'blue', isAI: false });
    }
    // AI pieces on line=2, spaces= 6..2 (in reverse or something)
    for (let i = 0; i < 5; i++) {
      pieces.push({ line: 2, space: spacesPerLine - 1 - i, color: 'red', isAI: true });
    }
  } else {
    // Human is right
    // Human pieces on line=2, spaces= 2..6
    for (let i = 0; i < 5; i++) {
      pieces.push({ line: 2, space: spacesPerLine - 1 - i, color: 'blue', isAI: false });
    }
    // AI on left
    for (let i = 0; i < 5; i++) {
      pieces.push({ line: 2, space: i, color: 'red', isAI: true });
    }
  }

  gameState = "playing";
  showOverlay(null);
  redrawBoard();
}

/*****************************************************************
 * 5) Drawing the lines + pieces
 *****************************************************************/
function redrawBoard() {
  ctx.clearRect(0, 0, W, H);
  drawLines();
  drawPieces();
}
function drawLines() {
  // We'll space them evenly in the vertical direction
  const lineSpacing = H / (lineCount + 1);
  for (let i = 1; i <= lineCount; i++) {
    let y = i * lineSpacing;
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(W, y);
    ctx.stroke();
  }
}
function drawPieces() {
  // Each line is a horizontal line from x=0..W
  // We have spacesPerLine = 7 spaces. We'll define them from x=some intervals
  const lineSpacing = H / (lineCount + 1);
  const spaceSpacing = W / (spacesPerLine + 1);

  pieces.forEach(piece => {
    let y = (piece.line + 1) * lineSpacing;
    let x = (piece.space + 1) * spaceSpacing;
    ctx.fillStyle = piece.color;
    ctx.beginPath();
    ctx.arc(x, y, 15, 0, Math.PI * 2);
    ctx.fill();
  });
}

/*****************************************************************
 * 6) Board click => attempt to move
 *****************************************************************/
canvas.addEventListener('mousedown', e => {
  if (gameState !== "playing") return;
  if (!diceRolled) {
    console.warn("Must roll dice first!");
    return;
  }
  if (currentTurn === 'ai') {
    console.warn("AI's turn. Wait!");
    return;
  }
  // Convert mouse coords to line/space
  const rect = canvas.getBoundingClientRect();
  let mx = e.clientX - rect.left, my = e.clientY - rect.top;

  let lineSpacing = H / (lineCount + 1);
  let spaceSpacing = W / (spacesPerLine + 1);

  // Figure out which line user clicked
  // line = floor((my / lineSpacing) - 0.5)
  // space = floor((mx / spaceSpacing) - 0.5)
  let line = Math.floor(my / lineSpacing) - 0;
  let space = Math.floor(mx / spaceSpacing) - 0;

  if (line < 0 || line >= lineCount) return;
  if (space < 0 || space >= spacesPerLine) return;

  // Find piece with color=blue (isAI=false) at (line,space)
  let pieceIndex = pieces.findIndex(p => !p.isAI && p.line === line && p.space === space);
  if (pieceIndex === -1) {
    console.warn("No piece of yours at that location.");
    return;
  }
  // Attempt to move that piece diceValue spaces forward or backward, etc. 
  // For now, let's say we move it 'diceValue' spaces to the left or right 
  // depending on which side is human. This is up to your rules.
  let newSpace = space;
  if (humanSide === 'left') {
    // Move to the right by diceValue
    newSpace = space + diceValue;
  } else {
    // Move to the left by diceValue
    newSpace = space - diceValue;
  }
  if (newSpace < 0 || newSpace >= spacesPerLine) {
    console.warn("Move out of bounds. Try another piece.");
    return;
  }
  // Check collision with any piece
  if (pieces.some(p => p.line === line && p.space === newSpace)) {
    console.warn("Space is occupied. Try another piece or roll again next turn.");
    return;
  }
  // Move piece
  pieces[pieceIndex].space = newSpace;

  // Log move
  addMoveToHistory(`Human: line=${line}, from space=${space} to space=${newSpace} (dice=${diceValue})`);

  diceRolled = false;
  diceValue = 0;
  document.getElementById('diceResult').textContent = "0";

  // If no rosette logic or partial rosette logic => end turn
  currentTurn = 'ai';
  setTimeout(aiTurn, 1200);
  redrawBoard();
});

/*****************************************************************
 * 7) AI Turn
 *****************************************************************/
function aiTurn() {
  if (!pieces.some(p => p.isAI)) return; // no AI pieces => no AI turn
  if (difficulty === "none") return; // user asked for no AI?

  // 1) Roll dice
  diceValue = Math.floor(Math.random() * 6) + 1;
  document.getElementById('diceResult').textContent = diceValue;

  // 2) Attempt to find a piece to move
  let aiPieces = pieces.filter(p => p.isAI);
  let success = false;

  // If side is left => AI is on the right => they move left by diceValue
  // If side is right => AI is on the left => they move right by diceValue
  // (or adapt to your logic)
  aiPieces.some(piece => {
    let oldSpace = piece.space;
    let newSpace = (humanSide === 'left') 
        ? oldSpace - diceValue
        : oldSpace + diceValue;
    if (newSpace >= 0 && newSpace < spacesPerLine) {
      // Check collision
      if (!pieces.some(pp => pp.line === piece.line && pp.space === newSpace)) {
        // Move
        piece.space = newSpace;
        addMoveToHistory(`AI: line=${piece.line}, from space=${oldSpace} to space=${newSpace} (dice=${diceValue})`);
        success = true;
        return true; // break
      }
    }
  });

  // If AI found no move, we do nothing => pass turn
  diceValue = 0;
  document.getElementById('diceResult').textContent = "0";
  diceRolled = false;
  currentTurn = 'human';
  redrawBoard();
}

/*****************************************************************
 * 8) Rolling the dice (Human)
 *****************************************************************/
document.getElementById('diceRollBtn').addEventListener('click', () => {
  if (gameState !== "playing") return;
  if (currentTurn !== 'human') {
    console.warn("Not your turn, or AI turn. Wait!");
    return;
  }
  if (diceRolled) {
    console.warn("Already rolled dice this turn!");
    return;
  }
  diceValue = Math.floor(Math.random() * 6) + 1;
  diceRolled = true;
  document.getElementById('diceResult').textContent = diceValue;
});

/*****************************************************************
 * 9) Move History
 *****************************************************************/
function addMoveToHistory(msg) {
  movesHistory.push(msg);
  let li = document.createElement('li');
  li.textContent = msg;
  movesList.appendChild(li);
  // Auto-scroll to bottom if many moves
  movesList.scrollTop = movesList.scrollHeight;
}

/*****************************************************************
 * 10) Overlays & Buttons
 *****************************************************************/
document.getElementById('newGameBtn').addEventListener('click', () => {
  showOverlay(difficultyScreen);
});
document.getElementById('instructionsBtn').addEventListener('click', () => {
  showOverlay(instructionsScreen);
});
// Difficulty
document.getElementById('easyBtn').addEventListener('click', () => {
  difficulty = 'easy';
});
document.getElementById('mediumBtn').addEventListener('click', () => {
  difficulty = 'medium';
});
document.getElementById('hardBtn').addEventListener('click', () => {
  difficulty = 'hard';
});
// Side
document.getElementById('leftSideBtn').addEventListener('click', () => {
  humanSide = 'left';
  startGame();
});
document.getElementById('rightSideBtn').addEventListener('click', () => {
  humanSide = 'right';
  startGame();
});
// Game Over
document.getElementById('gameOverNewGameBtn').addEventListener('click', () => {
  showOverlay(menuScreen);
});

/*****************************************************************
 * 11) Keyboard shortcuts
 *****************************************************************/
document.addEventListener('keydown', e => {
  if (e.key.toLowerCase() === 'm') {
    showOverlay(menuScreen);
  }
});

/*****************************************************************
 * 12) Start with menu
 *****************************************************************/
showOverlay(menuScreen);
redrawBoard(); // draw empty lines at first
requestAnimationFrame(function loop() {
  if (gameState === 'playing') {
    // maybe check for win conditions, etc.
  }
  requestAnimationFrame(loop);
});
</script>
</body>
</html>
